# Learning-SQL (2)

## 1. SELECT 文の機能

---

1. SELECT 文は表に格納されている「行」を取得する。

   1. 投影 / 射影：表から取得した行の中から、参照したい列を選択できる機能。例えば、FRUITS

      という表に FRUITS_ID 列、FRUITS＿NAME 列、PRICE 列などで構成されていれば、SELECT 文を利用して FRUITS_NAME 列を参照することができる。

   2. 選択：表から条件に合った行を取得する機能。例えば、FRUITS 表から PRICE が 600 である行を取得する場合に使用する。
   3. 結合：複数の表を値のリンクによって１つにする操作。

   簡単にまとめると下記の通りである。
   　射影(投影)：表から特定の列を取得します
   　選択：表から特定の行を取得します
   　結合：複数の表のデータを関連付けて取得します

## 2. SELECT 文の基本構成

---

A. 基本構成

```sql
SELECT *
FROM 表名
```

B. 参照する列を指定する場合

```sql
SELECT 列名(1), 列名(2) ...
FROM 表名
```

‼️ **覚えておきたいこと**

1. アスタリスク(※)は、特殊な記号であり、表の全ての列を意味する。
2. アスタリスクを使用しない場合、必ず列名を具体的に指定する。
3. SELECT 句と FROM 句で SELECT 文が成り立つ。
4. 戻される列の表示順については、列名を直接指定する場合、指定した順番で表示される。
5. 表示される列見出しは、デフォルトでは列名が大文字で表示される。
6. 列別名を使用することで、列見出しは変更することができる。

## 3. SELECT 文作成時の注意点とガイドライン

---

1. **注意点**

   1. キーワード、表名、列名のアルファベットの大文字や小文字の区別はない
   2. キーワードの一部を省略することや、1 つのキーワードの途中で改行はできない
   3. SQL\*Plus など環境によっては、文の終了を意味するセミコロンを末尾に付ける必要がある

1. **ガイドライン**
   1. 句ごとに改行すること (SELECT 句で１行、FROM 句で１行)
   2. 大文字や小文字を使い分ける (SQL キーワードを大文字で、列名や表名は小文字)
   3. 必要に応じてインデントを使用する

## 4. 算出式 & NULL を含む算出式

---

1. 演算子は通常通り、+, -, \*, /　が利用でき、優先順位は括弧を使用する。
2. NULL は、割り当てられていない値、不明な値、適用できない値
3. NULL が含まれている式は、いかなる算術演算子による計算結果も NULL になる(エラーにならない)

## 5. 列見出し & 列別名の変更方法

---

1. SELECT 句に指定した列名を大文字で表示する
2. 指定した式をそのまま表示する

```sql
SELECT last_name, salary, salary *12
→　salaryまでは本来用意されていた列だが、salary *12を書き込むことで新しい列名が追加できる

SELECT last_name, salary, salary *12 年間給与
→ 新しく追加された列名を別名「年間給与」で変更してくれる
```

1. 列別名の変更は AS キーワードで実行できるが、いくつかの注意点がある。

   1. 大文字・小文字を分類する場合は二重符号(" ")で囲む
   2. スペースを含む
   3. 数字や記号で開始する

2. その他
   1. AS を使用せず、1 つ以上の空白があれば列別名として指定できる。なお、列名には(-)は使用できない。

## 6. 連結演算子 & 重複文の排除

---

1. 連結演算子

   1. 連結演算子は | | で作成できる
   2. エスケープシーケンスを使用して、%などの表示も可能である
   3. q・シングルバイト文字・対称な記号を使用することで | | と同じ結果を作成できる
   4. 文字リテラルや日付リテラルを文字式で指定する場合は「’」一重引用符で囲む必要がある

   ```sql
   SELECT last_name || salary
   FROM employees;

   SELECT last_name || 'gets a salary of' || salary
   FROM employees;

   SELECT 'I''m' || last_name
   FROM employees;

   SELECT q'[I'm]' || last_name
   FROM employees;
   ```

1. 重複文の排除
   1. DISTINCT を使用すると重複した値を持つ行を一意にして表示できる
   2. DISTINCT は SELECT キーワードの直後に配置する
   3. DISTINCT の後に複数の列を指定すると、列の組合わせで一意にして表示する

```sql
SELECT DISTINCT job_id
```

問題
次の問い合わせを実行したところエラーが発生しました。

SELECT employee_name AS "Name", salary \* 12 AS "Sal", Sal + commission AS "Total"
FROM employees;

エラーの原因はどれですか。

SELECT 句に指定された算術式に列別名を指定することはできますが、算術式の中で列別名を使用することはできません。
設問の「Sal + commission」の部分の「Sal」は、SELECT 句の 2 つ目の項目に指定された列別名ですので使用することはできません。

以上より、
・算術式の中で列別名を使うことはできない
が正解となります。

その他の選択肢については以下のとおりです。

・SELECT 句に指定した項目が算術式の場合は、列別名を指定できない
算術式にも列別名を指定できます。

・列別名は一重引用符(')で囲まなければならない
一重引用符(')は文字リテラルや日付リテラルを囲むときに使用します。
列別名の大文字と小文字を区別したい場合や、スペース等を使用したい場合は列別名を二重引用符(")で囲みますので、設問の SQL 文で列別名は正しく指定されています。

・Sal + commission の Salary を二重引用符(")で囲まなければならない
二重引用符(")で囲んだとしても、列別名を算術式の中で使用することはできません。
